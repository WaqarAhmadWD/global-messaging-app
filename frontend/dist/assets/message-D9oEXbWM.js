import{_ as D,r as v,u as M,j as S,n as g,s as h,c as r,a,F as T,k as j,l as B,v as $,m as C,o as c,t as _,p as w}from"./index-BIxEO2-8.js";const A="/images/attach.svg",F="/images/send.svg",H={key:0,class:"flex gap-2 items-center justify-self-end"},L={class:"bg-gray-700 px-4 py-2 rounded-full"},O={key:1,class:"flex gap-2 items-center justify-self-start"},V={class:"bg-gray-700 px-4 py-2 rounded-full"},q={class:"w-full p-2 flex lg:bg-[#63636388] bg-[#474747] rounded-full items-center"},E={__name:"message",props:{id:{type:String,required:!0}},setup(p){const l=v(null),n=v(null),i=v(null),m=M(),e=p,d=async(o=!0,t=!0)=>{var s,y;const f=await m.fetchData({url:`/message/get/${e==null?void 0:e.id}`,loading:t,message:o});((y=(s=l.value)==null?void 0:s.data)==null?void 0:y.length)===0&&g(()=>u()),l.value=f},u=()=>{i.value&&(i.value.scrollTop=i.value.scrollHeight)},b=async()=>{i.value.scrollTop===0&&await x()},x=async()=>{var t;const o=await m.fetchData({url:`/message/get/${e==null?void 0:e.id}?before=${l.value.data[0]._id}`});(t=o.data)!=null&&t.length&&l.value.data.unshift(...o.data)};S(async()=>{await d(),g(()=>u())}),h.on("message",async()=>{console.log("Message received"),d?(await d(!1,!1),g(()=>u())):console.error("fetchData is undefined")});const k=async()=>{n.value&&(e!=null&&e.id)&&(await m.fetchData({url:`/message/send/${e==null?void 0:e.id}`,method:"POST",data:{message:n.value},message:!1,loading:!1}),h.emit("message",e==null?void 0:e.id),n.value="",await d(!1,!1),g(()=>u()))};return(o,t)=>{var f;return c(),r("div",null,[a("div",{ref_key:"chatContainer",ref:i,class:"mt-[6rem] overflow-y-auto lg:h-[calc(100vh-12rem)] h-[calc(100vh-16rem)]",onScroll:b},[(c(!0),r(T,null,j((f=l.value)!=null&&f.data?l.value.data:[],s=>(c(),r("div",{key:s._id,class:"p-4 grid items-center w-full"},[s.receiver===(e==null?void 0:e.id)?(c(),r("div",H,[a("div",L,_(s==null?void 0:s.message),1),t[1]||(t[1]=a("img",{src:w,alt:"",class:"w-8 h-8"},null,-1))])):(c(),r("div",O,[t[2]||(t[2]=a("img",{src:w,alt:"",class:"w-8 h-8"},null,-1)),a("div",V,_(s==null?void 0:s.message),1)]))]))),128))],544),a("form",{onSubmit:C(k,["prevent"]),class:"py-4 lg:px-32 px-2 justify-between -translate-y-16 lg:translate-y-0 fixed bottom-0 form-container"},[a("div",q,[B(a("input",{type:"text",class:"w-full border-none outline-none grow bg-transparent pl-4","onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),placeholder:"Message Here!"},null,512),[[$,n.value]]),t[3]||(t[3]=a("img",{src:A,alt:"",class:"w-6 h-6 mr-2"},null,-1)),t[4]||(t[4]=a("button",{class:"p-2 bg-[#A052C6] rounded-full",type:"submit"},[a("img",{src:F,alt:"",class:"md:w-6 md:h-6"})],-1))])],32)])}}},N=D(E,[["__scopeId","data-v-8c2f1571"]]);export{N as default};
