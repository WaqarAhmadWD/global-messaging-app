import{i as S,r as g,u as C,j as T,n as w,s as _,c as r,F as $,k as L,l as M,a as n,m as q,v as B,p as N,q as E,t as V,o as d,x as p,y as k}from"./index-BQpoMu_H.js";import{_ as A,a as F}from"./send-BRNNo5Pw.js";const H={key:0,class:"flex gap-2 items-center justify-self-end"},I={class:"bg-gray-700 px-4 py-2 rounded-full"},O={key:1,class:"flex gap-2 items-center justify-self-start"},R={class:"bg-gray-700 px-4 py-2 rounded-full"},z={key:1,class:"w-full flex justify-center items-center text-2xl font-bold h-[50vh]"},G={key:2,class:"w-full animate-pulse grid gap-2 pt-16 p-4"},J={class:"w-full p-2 flex lg:bg-[#63636388] bg-[#474747] rounded-full items-center"},P={__name:"message",props:{id:{type:String,required:!0},name:{type:String,required:!0}},setup(x){const m=V(),o=g(null),u=g(null),c=g(null),y=g(null),l=C(),a=x,v=async(s=null,t=!1)=>{const e=await l.fetchData({url:`/message/get/${a==null?void 0:a.id}`,cache:s,refresh:t});o.value=e},h=()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)},b=g(!1),j=async()=>{var s,t;if(!b.value&&c.value.scrollTop===0){console.log("Reached the top of the chat!");const e=await l.fetchData({url:`/message/get/${a==null?void 0:a.id}?skip=${(t=(s=o==null?void 0:o.value)==null?void 0:s.data)==null?void 0:t.length}`,method:"GET"});e&&e.data?o.value.data=[...e.data,...o.value.data]:e.message&&(b.value=!0),c.value.scrollTop=10}};T(async()=>{var s;if(y.value=JSON.parse(localStorage.getItem("user")),await v(`message-${a==null?void 0:a.id}`,!1),((s=m==null?void 0:m.query)==null?void 0:s.notification)>0){const t=await l.fetchData({url:"/contact/get",cache:"contact",refresh:!0});t.data&&(l.notificationsCounter=t.data.reduce((e,f)=>e+f.notifications,0),l.notificationsList=t.data.filter(e=>e.notifications>0),console.log(l==null?void 0:l.notificationsCounter))}c.value&&c.value.addEventListener("scroll",j),w(()=>h())}),_.on("message",async()=>{if(console.log("Message received"),v){await v(`message-${a==null?void 0:a.id}`,!0);const s=await l.fetchData({url:"/contact/get",cache:"contact",refresh:!0});s.data&&(l.notificationsCounter=s.data.reduce((t,e)=>t+e.notifications,0),l.notificationsList=s.data.filter(t=>t.notifications>0),console.log(l==null?void 0:l.notificationsCounter))}else console.error("fetchData is undefined")});const D=async()=>{var s;if(u.value&&(a!=null&&a.id)){await l.fetchData({url:`/message/send/${a==null?void 0:a.id}`,method:"POST",data:{message:u.value}});const t=await l.fetchData({url:"/contact/get",cache:"contact",refresh:!0});t.data&&(l.notificationsCounter=t.data.reduce((e,f)=>e+f.notifications,0),l.notificationsList=t.data.filter(e=>e.notifications>0)),_.emit("message",{id:a==null?void 0:a.id,name:(s=y.value)==null?void 0:s.name}),u.value="",await v(!1,!1),w(()=>h())}};return(s,t)=>{var e,f;return d(),r("div",null,[o.value?(d(),r("div",{key:0,ref_key:"chatContainer",ref:c,class:"mt-[6rem] overflow-y-auto lg:h-[calc(100vh-12rem)] h-[calc(100vh-16rem)]"},[(d(!0),r($,null,L((e=o.value)!=null&&e.data?o.value.data:[],i=>(d(),r("div",{key:i._id,class:"p-4 grid items-center w-full"},[i.receiver===(a==null?void 0:a.id)?(d(),r("div",H,[n("div",I,p(i==null?void 0:i.message),1),t[1]||(t[1]=n("img",{src:k,alt:"",class:"w-8 h-8"},null,-1))])):(d(),r("div",O,[t[2]||(t[2]=n("img",{src:k,alt:"",class:"w-8 h-8"},null,-1)),n("div",R,p(i==null?void 0:i.message),1)]))]))),128))],512)):((f=u.value)==null?void 0:f.length)<1?(d(),r("div",z," No public contact yet ")):(d(),r("div",G,t[3]||(t[3]=[M('<div class="lg:h-12 h-8 w-[30%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-start" data-v-cfbc8275></div><div class="lg:h-12 h-8 w-[40%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-end" data-v-cfbc8275></div><div class="lg:h-12 h-8 w-1/2 bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-start" data-v-cfbc8275></div><div class="lg:h-12 h-8 w-[30%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-end" data-v-cfbc8275></div><div class="lg:h-12 h-8 w-[80%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-start" data-v-cfbc8275></div><span class="sr-only" data-v-cfbc8275>Loading...</span>',6)]))),n("form",{onSubmit:E(D,["prevent"]),class:"py-4 lg:px-32 px-2 justify-between -translate-y-16 lg:translate-y-0 fixed bottom-0 form-container"},[n("div",J,[q(n("input",{type:"text",class:"w-full border-none outline-none grow bg-transparent pl-4","onUpdate:modelValue":t[0]||(t[0]=i=>u.value=i),placeholder:"Message Here!"},null,512),[[B,u.value]]),t[5]||(t[5]=n("img",{src:A,alt:"",class:"w-6 h-6 mr-2"},null,-1)),n("button",{class:N(["p-2 rounded-full",[u.value?"bg-[#A052C6]":"bg-gray-900"]]),type:"submit"},t[4]||(t[4]=[n("img",{src:F,alt:"",class:"md:w-6 md:h-6"},null,-1)]),2)])],32)])}}},Q=S(P,[["__scopeId","data-v-cfbc8275"]]);export{Q as default};
