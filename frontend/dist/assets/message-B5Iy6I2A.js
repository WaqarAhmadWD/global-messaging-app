import{_ as p,r as y,u as D,j as S,n as f,s as w,c as l,F as M,k as T,l as $,a as s,m as q,v as B,p as C,q as L,o as i,t as _,x,y as N}from"./index-CSFkjEWk.js";const V="/images/attach.svg",A="/images/send.svg",F={key:0,class:"flex gap-2 items-center justify-self-end"},H={class:"bg-gray-700 px-4 py-2 rounded-full"},z={key:1,class:"flex gap-2 items-center justify-self-start"},E={class:"bg-gray-700 px-4 py-2 rounded-full"},I={key:1,class:"w-full flex justify-center items-center text-2xl font-bold h-[50vh]"},O={key:2,class:"w-full animate-pulse grid gap-2 pt-16 p-4"},P={class:"w-full p-2 flex lg:bg-[#63636388] bg-[#474747] rounded-full items-center"},R={__name:"message",props:{id:{type:String,required:!0},name:{type:String,required:!0}},setup(k){const v=N(),r=y(null),n=y(null),u=y(null),m=D(),e=k,o=async(b=null,t=!1)=>{var d,a,h;const g=await m.fetchData({url:`/message/get/${e==null?void 0:e.id}`,cache:b,refresh:t});((d=v==null?void 0:v.query)==null?void 0:d.notification)>0&&await m.fetchData({url:`/message/get/${e==null?void 0:e.id}`,cache:"contact",refresh:!0}),((h=(a=r.value)==null?void 0:a.data)==null?void 0:h.length)===0&&f(()=>c()),r.value=g},c=()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)};S(async()=>{await o(`message-${e==null?void 0:e.id}`,!1),f(()=>c())}),w.on("message",async()=>{console.log("Message received"),o?(await o(`message-${e==null?void 0:e.id}`,!0),f(()=>c())):console.error("fetchData is undefined")});const j=async()=>{n.value&&(e!=null&&e.id)&&(await m.fetchData({url:`/message/send/${e==null?void 0:e.id}`,method:"POST",data:{message:n.value}}),w.emit("message",{id:e==null?void 0:e.id,name:e==null?void 0:e.name}),n.value="",await o(!1,!1),f(()=>c()))};return(b,t)=>{var g,d;return i(),l("div",null,[r.value?(i(),l("div",{key:0,ref_key:"chatContainer",ref:u,class:"mt-[6rem] overflow-y-auto lg:h-[calc(100vh-12rem)] h-[calc(100vh-16rem)]"},[(i(!0),l(M,null,T((g=r.value)!=null&&g.data?r.value.data:[],a=>(i(),l("div",{key:a._id,class:"p-4 grid items-center w-full"},[a.receiver===(e==null?void 0:e.id)?(i(),l("div",F,[s("div",H,_(a==null?void 0:a.message),1),t[1]||(t[1]=s("img",{src:x,alt:"",class:"w-8 h-8"},null,-1))])):(i(),l("div",z,[t[2]||(t[2]=s("img",{src:x,alt:"",class:"w-8 h-8"},null,-1)),s("div",E,_(a==null?void 0:a.message),1)]))]))),128))],512)):((d=n.value)==null?void 0:d.length)<1?(i(),l("div",I," No public contact yet ")):(i(),l("div",O,t[3]||(t[3]=[$('<div class="lg:h-12 h-8 w-[30%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-start" data-v-0557b760></div><div class="lg:h-12 h-8 w-[40%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-end" data-v-0557b760></div><div class="lg:h-12 h-8 w-1/2 bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-start" data-v-0557b760></div><div class="lg:h-12 h-8 w-[30%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-end" data-v-0557b760></div><div class="lg:h-12 h-8 w-[80%] bg-gray-200 rounded-full dark:bg-gray-700 lg:mb-2 justify-self-start" data-v-0557b760></div><span class="sr-only" data-v-0557b760>Loading...</span>',6)]))),s("form",{onSubmit:L(j,["prevent"]),class:"py-4 lg:px-32 px-2 justify-between -translate-y-16 lg:translate-y-0 fixed bottom-0 form-container"},[s("div",P,[q(s("input",{type:"text",class:"w-full border-none outline-none grow bg-transparent pl-4","onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),placeholder:"Message Here!"},null,512),[[B,n.value]]),t[5]||(t[5]=s("img",{src:V,alt:"",class:"w-6 h-6 mr-2"},null,-1)),s("button",{class:C(["p-2 rounded-full",[n.value?"bg-[#A052C6]":"bg-gray-900"]]),type:"submit"},t[4]||(t[4]=[s("img",{src:A,alt:"",class:"md:w-6 md:h-6"},null,-1)]),2)])],32)])}}},G=p(R,[["__scopeId","data-v-0557b760"]]);export{G as default};
